<div class="todo-list-container">
  <h2 class="section-title">Ma Liste de Tâches</h2>

  <!-- Section pour ajouter une nouvelle tâche -->
  <div class="new-task-form card">
    <h3 class="card-title">Ajouter une nouvelle tâche</h3>
    <div class="form-group">
      <label for="task-title">Titre de la tâche</label>
      <input type="text" id="task-title" [(ngModel)]="newTask.title" placeholder="Ex: Préparer la réunion client">
    </div>
    <div class="form-group">
      <label for="task-notes">Notes / Commentaires</label>
      <textarea id="task-notes" [(ngModel)]="newTask.notes" placeholder="Détails importants, rappels..."></textarea>
    </div>
    <div class="form-group">
      <label for="task-due-date">Date d'échéance (optionnel)</label>
      <input type="date" id="task-due-date" [(ngModel)]="newTask.dueDate">
    </div>

    <!-- Section pour les sous-tâches -->
    <div class="subtasks-section">
      <h4 class="subtasks-title">Sous-tâches</h4>
      <div *ngFor="let subtask of newTask.subtasks; let i = index" class="subtask-item">
        <input type="text" [(ngModel)]="subtask.description" placeholder="Description de la sous-tâche">
        <button (click)="removeNewSubtask(i)" class="btn-icon">
          <img src="assets/icons/remove.png" alt="Supprimer" class="icon-small">
        </button>
      </div>
      <button (click)="addNewSubtask()" class="btn-secondary btn-small">
        <img src="assets/icons/add.png" alt="Ajouter" class="button-icon-left"> Ajouter une sous-tâche
      </button>
    </div>

    <button (click)="addTask()" class="btn-primary add-task-btn">Ajouter la tâche</button>
  </div>

  <!-- Section pour afficher les tâches existantes -->
  <div class="tasks-list">
    <div *ngIf="loadingTasks" class="info-message">Chargement des tâches...</div>
    <div *ngIf="!loadingTasks && tasks.length === 0" class="info-message">Aucune tâche pour le moment. Ajoutez-en une !</div>

    <div *ngFor="let task of tasks" class="task-item card" [class.completed]="task.completed">
      <div class="task-header">
        <input type="checkbox" [(ngModel)]="task.completed" (change)="toggleTaskCompletion(task)">
        <h3 class="task-title" [class.completed-text]="task.completed">{{ task.title }}</h3>
        <span *ngIf="task.dueDate" class="task-due-date">
          Échéance: {{ task.dueDate | date:'shortDate' }}
        </span>
        <div class="task-actions">
          <button (click)="editTask(task)" class="btn-icon">
            <img src="assets/icons/edit.png" alt="Modifier" class="icon-small">
          </button>
          <button (click)="deleteTask(task.id)" class="btn-icon delete-btn">
            <img src="assets/icons/delete.png" alt="Supprimer" class="icon-small">
          </button>
        </div>
      </div>

      <p *ngIf="task.notes" class="task-notes">{{ task.notes }}</p>

      <div *ngIf="task.subtasks && task.subtasks.length > 0" class="task-subtasks">
        <h4>Sous-tâches :</h4>
        <ul>
          <li *ngFor="let subtask of task.subtasks" [class.completed]="subtask.completed">
            <input type="checkbox" [(ngModel)]="subtask.completed" (change)="toggleSubtaskCompletion(task, subtask)">
            <span [class.completed-text]="subtask.completed">{{ subtask.description }}</span>
          </li>
        </ul>
      </div>
    </div>
  </div>
</div>
